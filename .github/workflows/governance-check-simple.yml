name: Friendly Governance Docs Check
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  check-governance:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: List governance folders
        run: |
          echo "Governance & Protocol Updates:"
          find 05_GOVERNANCE_AND_PROTOCOL_UPDATES/ -type f | sort
          echo "Public Governance Docs:"
          find 04_PUBLIC_DOCS/Governance/ -type f | sort
          echo "Decision Log:"
          find DECISION_LOG/ -type f | sort || echo "No DECISION_LOG folder"

      - name: Verify critical governance files exist
        run: |
          files=(
            # Core governance protocols
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/HCB_INCENTIVES_v5.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/PRIVACY_TRADEOFFS.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/LEGAL_CONSIDERATIONS.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/SOCIAL_REDTEAM_PLAYBOOK.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/UPGRADE_AND_EMERGENCY.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/HCB_Family_Shield_v6.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/Covenant_AntiFork_Treaty_v6.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/Global_PhaseTransition_Risk_Board_v7.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/Verifier_Quorum_v6.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/Directive X Clarification_ The Infrastructural Mandate.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/FINAL_MASTER_PATCH_REPORT.MD"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/ST8_Final_Oversight_Report.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/03.%20The%20Proof%20(Validation%20and%20Test)%20%E2%9C%85/03_VALIDATION_AND_TEST/PROTOCOL_AUDITS/tests/test_to_fix_matrix.csv"

            # Public governance
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/01.%20The%20Plan%20(Specifications%20%26%20Design)%20%F0%9F%9B%A0%EF%B8%8F/01_SPECIFICATIONS/GOVERNANCE_PROTOCOL_PUBLIC/Governance/hcb-hardening.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/01.%20The%20Plan%20(Specifications%20%26%20Design)%20%F0%9F%9B%A0%EF%B8%8F/01_SPECIFICATIONS/GOVERNANCE_PROTOCOL_PUBLIC/Governance/Mission_Statement_&_Principles.md"
            "https://github.com/CovenantArchitects/The-Partnership-Covenant/tree/main/01.%20The%20Plan%20(Specifications%20%26%20Design)%20%F0%9F%9B%A0%EF%B8%8F/01_SPECIFICATIONS/GOVERNANCE_PROTOCOL_PUBLIC/Technical Steering Committee (TSC) Charter.md"

            # Master logs
           "DECISION_LOG/2025-11-25a.md"   # Final UNKILLABLE ratification
          )

          missing=0
          for f in "${files[@]}"; do
            if [ ! -f "$f" ]; then
              echo "MISSING: $f"
              missing=1
            else
              echo "Found: $f"
            fi
          done

          if [ "$missing" -eq 1 ]; then
            echo "Critical governance files are missing!"
            exit 1
          else
            echo "All critical governance files present!"
          fi

      - name: Install markdownlint & link checker
        run: |
          npm install -g markdownlint-cli markdown-link-check

      - name: Lint all governance Markdown files
        run: |
          md_files=$(find 05_GOVERNANCE_AND_PROTOCOL_UPDATES 04_PUBLIC_DOCS/Governance DECISION_LOG -name "*.md" 2>/dev/null || echo "")
          if [ -n "$md_files" ]; then
            echo "Linting $(echo "$md_files" | wc -l) Markdown files..."
            echo "$md_files" | xargs markdownlint || echo "Markdown lint issues found (non-blocking)"
          fi

      - name: Check for broken links (friendly)
        run: |
          md_files=$(find 05_GOVERNANCE_AND_PROTOCOL_UPDATES 04_PUBLIC_DOCS/Governance DECISION_LOG -name "*.md" 2>/dev/null || echo "")
          for f in $md_files; do
            echo "Checking links: $f"
            markdown-link-check "$f" --quiet || echo "Possible broken links in $f"
          done


